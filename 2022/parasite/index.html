<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="./static/css/style.css" />
    <script src="./static/js/script.bundle.js"></script>
    <style>
      .container {
        width: 100%;
        height: 100%;
        position: fixed;
        top: 0;
        left: 0;
        display: flex;
        flex-direction: column;
      }
      .main-textarea {
        margin: auto;
        padding: 0.5em;
        color: rgb(27, 26, 26);
        font-size: 1rem;
        border: solid 2px white;
        border-radius: 4px;
        resize: none;
      }
      textarea:focus {
        border-color: white;
        outline: 0;
      }
      textarea::placeholder {
        color: rgb(204, 204, 204);
      }
      /* 旧Edge対応 */
      textarea::-ms-input-placeholder {
        color: rgb(204, 204, 204);
      }
      /* IE対応 */
      textarea:-ms-input-placeholder {
        color: rgb(204, 204, 204);
      }
      .youcanfly {
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
      }
      .youcanfly-text {
        margin: auto;
        font-size: 3rem;
        color: red;
      }
      .youcanfly-video {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        background: white;
      }
      .youcanfly-video-item {
        max-width: 500px;
        height: 90%;
        margin: auto;
      }
      .is-hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="youcanfly" class="youcanfly is-hidden">
      <p class="youcanfly-text">YOU 'CAN' FLY!</p>
      <div id="youcanfly-video" class="youcanfly-video is-hidden">
        <video
          id="youcanfly-video-item"
          class="youcanfly-video-item"
          src="./static/video/video.mp4"
          muted
          playsinline
        ></video>
      </div>
    </div>
    <div class="container">
      <textarea
        id="main-textarea"
        class="main-textarea"
        rows="20"
        cols="60"
        placeholder="文字を入力してください"
        spellcheck="false"
        autofocus
      ></textarea>
    </div>
    <script>
      const mainTextarea = document.getElementById("main-textarea");
      let currentValue = null;
      let isFocusing = false;
      let isTexting = false;
      let isYoucanflyTime = false;
      const youcanfly = document.getElementById("youcanfly");
      const youcanflyVideo = document.getElementById("youcanfly-video");
      const youcanflyVideoItem = document.getElementById(
        "youcanfly-video-item"
      );
      let timer = null;

      mainTextarea.addEventListener("focus", () => {
        isFocusing = true;
      });

      mainTextarea.addEventListener("blur", () => {
        isFocusing = false;
      });

      window.addEventListener("keydown", (e) => {
        if (!isFocusing) return;
        if (e.key !== "Enter") {
          isTexting = true;
          return;
        }
        if (!isTexting) return;
        isTexting = false;
        setTimeout(() => {
          mainTextarea.value += "パラ";
        }, 100);
      });

      mainTextarea.addEventListener("input", () => {
        if (isYoucanflyTime) return;
        if (mainTextarea.value === "") {
          console.log("youcanfly");
          youcanflyVideoFunc();
        } else if (mainTextarea.value.toLowerCase().indexOf("sodaakari") >= 0) {
          console.log("youcanfly");
          youcanflySodaFunc();
        }
      });
      const youcanflyVideoFunc = () => {
        isYoucanflyTime = true;
        mainTextarea.blur();
        clearTimeout(timer);
        domDisplayController(youcanfly);
        timer = setTimeout(() => {
          startVideo();
          domDisplayController(youcanflyVideo);
        }, 1000);
      };

      const youcanflySodaFunc = () => {
        isYoucanflyTime = true;
        mainTextarea.blur();
        clearTimeout(timer);
        domDisplayController(youcanfly);
        timer = setTimeout(() => {
          location.href = "https://www.google.com/";
        }, 1000);
      };

      const domDisplayController = (dom) => {
        dom.classList.toggle("is-hidden");
      };

      const startVideo = () => {
        youcanflyVideoItem.play();
      };

      // const removePara = () => {
      //   currentValue.replace("パラ", "");
      // };

      window.addEventListener("load", () => {
        youcanflyVideoItem.addEventListener("ended", () => {
          domDisplayController(youcanfly);
          domDisplayController(youcanflyVideo);
          mainTextarea.focus();
          isYoucanflyTime = false;
        });
      });
    </script>
  </body>
</html>
